---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - tsconfig.json
  - biome.json
  - vitest.config.ts
  - src/index.ts
autonomous: true

must_haves:
  truths:
    - "pnpm build compiles TypeScript without errors"
    - "pnpm lint runs Biome linter on TypeScript files"
    - "pnpm format runs Biome formatter"
    - "pnpm test runs Vitest (passes with no tests)"
  artifacts:
    - path: "tsconfig.json"
      provides: "TypeScript compiler configuration"
      contains: "NodeNext"
    - path: "biome.json"
      provides: "Biome linter and formatter configuration"
      contains: "biomejs.dev"
    - path: "vitest.config.ts"
      provides: "Vitest test runner configuration"
      contains: "defineConfig"
    - path: "src/index.ts"
      provides: "Entry point placeholder for build verification"
      min_lines: 1
    - path: "dist/index.js"
      provides: "Compiled JavaScript output"
      min_lines: 1
  key_links:
    - from: "tsconfig.json"
      to: "dist/"
      via: "tsc compilation"
      pattern: "outDir.*dist"
    - from: "package.json scripts.lint"
      to: "biome.json"
      via: "biome lint command"
      pattern: "biome lint"
    - from: "vitest.config.ts"
      to: "src/**/*.test.ts"
      via: "test include pattern"
      pattern: "include.*test\\.ts"
---

<objective>
Configure TypeScript, Biome, and Vitest tooling with proper configuration files.

Purpose: Enable the core developer workflow (build, lint, format, test) that all future development depends on.
Output: Working toolchain where all pnpm scripts execute successfully.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure TypeScript with NodeNext</name>
  <files>tsconfig.json, src/index.ts</files>
  <action>
    1. Create tsconfig.json with NodeNext configuration:

    ```json
    {
      "compilerOptions": {
        "target": "ES2023",
        "module": "NodeNext",
        "moduleResolution": "NodeNext",
        "strict": true,
        "esModuleInterop": true,
        "skipLibCheck": true,
        "outDir": "dist",
        "rootDir": "src",
        "declaration": true,
        "declarationMap": true,
        "sourceMap": true,
        "noUncheckedIndexedAccess": true,
        "isolatedModules": true,
        "verbatimModuleSyntax": true
      },
      "include": ["src"],
      "exclude": ["node_modules", "dist"]
    }
    ```

    2. Create src/index.ts as a placeholder:

    ```typescript
    /**
     * Kata Context - Context policy engine for AI agents
     * @packageDocumentation
     */

    export const VERSION = "0.1.0";
    ```

    CRITICAL: module and moduleResolution MUST both be "NodeNext" (not "node" or "bundler").
    CRITICAL: strict MUST be true (requirement INIT-01).
  </action>
  <verify>
    - `pnpm build` completes without errors
    - `ls dist/index.js dist/index.d.ts` both exist
    - `grep "NodeNext" tsconfig.json` returns matches
    - `grep '"strict": true' tsconfig.json` returns match
  </verify>
  <done>
    - tsconfig.json exists with strict: true and NodeNext resolution
    - src/index.ts exists with placeholder export
    - dist/index.js generated by build
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure Biome for linting and formatting</name>
  <files>biome.json</files>
  <action>
    Create biome.json with recommended configuration:

    ```json
    {
      "$schema": "https://biomejs.dev/schemas/2.3.11/schema.json",
      "vcs": {
        "enabled": true,
        "clientKind": "git",
        "useIgnoreFile": true,
        "defaultBranch": "main"
      },
      "files": {
        "ignoreUnknown": true
      },
      "formatter": {
        "enabled": true,
        "indentStyle": "space",
        "indentWidth": 2,
        "lineWidth": 100,
        "lineEnding": "lf"
      },
      "linter": {
        "enabled": true,
        "rules": {
          "recommended": true
        }
      },
      "organizeImports": {
        "enabled": true
      },
      "javascript": {
        "formatter": {
          "quoteStyle": "double",
          "semicolons": "always",
          "trailingCommas": "all"
        }
      }
    }
    ```

    This configures:
    - Git integration (respects .gitignore)
    - 2-space indentation with LF line endings
    - Double quotes and semicolons (consistent style)
    - Trailing commas (cleaner git diffs)
    - All recommended lint rules enabled
  </action>
  <verify>
    - `pnpm lint` runs without errors (may show 0 issues or info about files)
    - `pnpm format` runs without errors
    - `pnpm check` runs without errors
  </verify>
  <done>
    - biome.json exists with linter and formatter enabled
    - pnpm lint, format, and check commands all work
  </done>
</task>

<task type="auto">
  <name>Task 3: Configure Vitest for testing</name>
  <files>vitest.config.ts</files>
  <action>
    Create vitest.config.ts:

    ```typescript
    import { defineConfig } from "vitest/config";

    export default defineConfig({
      test: {
        globals: true,
        environment: "node",
        include: ["src/**/*.test.ts"],
        coverage: {
          provider: "v8",
          reporter: ["text", "json", "html"],
        },
      },
    });
    ```

    This configures:
    - Global test functions (describe, it, expect without imports)
    - Node environment (not jsdom - avoids compatibility issues)
    - Test files pattern: src/**/*.test.ts
    - V8 coverage provider (native, fast)

    NOTE: Do NOT add jsdom or browser environment - Phase 1 is server-side only.
  </action>
  <verify>
    - `pnpm test` runs (should pass with "no test files found" or similar - that's OK)
    - `cat vitest.config.ts | grep "defineConfig"` returns match
  </verify>
  <done>
    - vitest.config.ts exists
    - pnpm test executes Vitest (even with no test files)
  </done>
</task>

</tasks>

<verification>
Run full verification of all Phase 1 requirements:

```bash
# INIT-01: TypeScript with strict and NodeNext
grep '"strict": true' tsconfig.json && grep '"moduleResolution": "NodeNext"' tsconfig.json

# INIT-02: pnpm with lockfile (verified in Plan 01)
ls pnpm-lock.yaml

# INIT-03: All scripts present
cat package.json | grep -E '"dev"|"build"|"test"|"lint"|"format"'

# TOOL-01: Biome linting and formatting
pnpm lint && pnpm format

# TOOL-02: Vitest testing
pnpm test

# Build verification
pnpm build && ls dist/index.js
```
</verification>

<success_criteria>
1. `pnpm build` compiles src/index.ts to dist/index.js without errors
2. `pnpm lint` runs Biome linter successfully
3. `pnpm format` runs Biome formatter successfully
4. `pnpm test` runs Vitest (passes even with no test files)
5. tsconfig.json has strict: true and moduleResolution: NodeNext
6. All Phase 1 requirements (INIT-01, INIT-02, INIT-03, TOOL-01, TOOL-02) satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
