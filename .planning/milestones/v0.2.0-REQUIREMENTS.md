# Requirements Archive: v0.2.0 Database + Storage Layer

**Archived:** 2026-02-04
**Status:** SHIPPED

This is the archived requirements specification for v0.2.0.

---

## v0.2.0 Database + Storage Layer

### Database Infrastructure

- [x] **DB-01**: PostgreSQL database provisioned on Neon with pgvector extension enabled
- [x] **DB-02**: Drizzle ORM configured with type-safe schema definitions
- [x] **DB-03**: Database migration workflow established (generate -> migrate)
- [x] **DB-04**: Serverless connection pooling configured (pg driver + Vercel Fluid)

### Schema

- [x] **SCHEMA-01**: Contexts table with id, metadata, created_at, updated_at, deleted_at
- [x] **SCHEMA-02**: Messages table with context_id, role, content, token_count, sequence, created_at
- [x] **SCHEMA-03**: Embedding column on messages (vector type, unpopulated until v0.3.0)
- [x] **SCHEMA-04**: Indexes for efficient retrieval (context_id + sequence, deleted_at)

### Data Access

- [x] **DATA-01**: Create new context with optional metadata
- [x] **DATA-02**: Retrieve context by ID with message count
- [x] **DATA-03**: Append messages to context (batch insert with sequence assignment)
- [x] **DATA-04**: Retrieve messages with cursor-based pagination
- [x] **DATA-05**: Soft delete context (set deleted_at, preserve history)
- [x] **DATA-06**: Token-budgeted windowing (retrieve last N tokens worth of messages)

### API Endpoints

- [x] **API-01**: POST /api/v1/contexts - create new context, returns context_id
- [x] **API-02**: GET /api/v1/contexts/:id - retrieve context with metadata and message count
- [x] **API-03**: DELETE /api/v1/contexts/:id - soft delete context
- [x] **API-04**: POST /api/v1/contexts/:id/messages - append messages to context
- [x] **API-05**: GET /api/v1/contexts/:id/messages - retrieve messages with pagination
- [x] **API-06**: GET /api/v1/contexts/:id/window?budget=N - retrieve token-budgeted window

### Testing

- [x] **TEST-01**: Unit tests for repository layer with mocked database
- [x] **TEST-02**: Integration tests for API endpoints against test database
- [x] **TEST-03**: Token-budgeted windowing edge cases (empty context, budget exceeds total)

---

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| DB-01 | Phase 3 | Complete |
| DB-02 | Phase 3 | Complete |
| DB-03 | Phase 3 | Complete |
| DB-04 | Phase 3 | Complete |
| SCHEMA-01 | Phase 3 | Complete |
| SCHEMA-02 | Phase 3 | Complete |
| SCHEMA-03 | Phase 3 | Complete |
| SCHEMA-04 | Phase 3 | Complete |
| DATA-01 | Phase 4 | Complete |
| DATA-02 | Phase 4 | Complete |
| DATA-03 | Phase 4 | Complete |
| DATA-04 | Phase 4 | Complete |
| DATA-05 | Phase 4 | Complete |
| DATA-06 | Phase 4 | Complete |
| API-01 | Phase 5 | Complete |
| API-02 | Phase 5 | Complete |
| API-03 | Phase 5 | Complete |
| API-04 | Phase 5 | Complete |
| API-05 | Phase 5 | Complete |
| API-06 | Phase 5 | Complete |
| TEST-01 | Phase 5 | Complete |
| TEST-02 | Phase 5 | Complete |
| TEST-03 | Phase 5 | Complete |

---

## Milestone Summary

**Shipped:** 23 of 23 requirements
**Adjusted:** None
**Dropped:** None

---
*Archived: 2026-02-04 as part of v0.2.0 milestone completion*
